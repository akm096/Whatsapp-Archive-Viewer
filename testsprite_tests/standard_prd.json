{
  "meta": {
    "project": "WhatsApp Chat Viewer",
    "date": "2026-02-14",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "A privacy-first, fully client-side web app that imports WhatsApp exported chats (ZIP or folder), parses them in a Web Worker, stores metadata in IndexedDB, and renders a WhatsApp-like conversation viewer with media support and search.",
  "core_goals": [
    "Enable secure, client-side import and parsing of WhatsApp chat exports (ZIP or folder) without uploading data to any server.",
    "Provide a performant, WhatsApp-like conversation viewer that supports very large chats (virtualized scrolling + Web Worker parsing).",
    "Support inline media preview (images, video, audio, PDF) with graceful handling for missing media and re-import workflows.",
    "Persist parsed chat JSON and metadata to IndexedDB for fast reloading while keeping raw media blobs out of persistence for privacy.",
    "Provide robust full-text search across messages with highlighting and navigation between matches."
  ],
  "features": [
    {
      "name": "Chat Import System",
      "description": "Import WhatsApp exports via ZIP, folder picker, or drag-and-drop; parse messages in a Web Worker; build media index and persist parsed JSON/metadata to IndexedDB.",
      "user_flows": [
        "User selects .zip via ImportDropzone -> call app/lib/zip.readZip(file) -> spawn workers/parseWorker.parse with zip contents -> workers/parseWorker returns parsed messages and metadata -> call app/lib/mediaIndex.build(mediaFiles, zipEntries) -> call app/lib/idb.saveChat(parsedChat, metadata) -> navigate to /?chatId={chatId} and update useChatStore",
        "User selects extracted folder via ImportDropzone (webkitdirectory) -> call app/lib/folder.readFolder(folderHandle) -> spawn workers/parseWorker.parse with folder file list -> workers/parseWorker returns parsed messages and metadata -> call app/lib/idb.saveChat(parsedChat, metadata) -> navigate to /?chatId={chatId}",
        "Drag-and-drop .zip onto ImportDropzone -> call app/lib/zip.readZip(file) -> zip.readZip throws error (corrupt or unsupported) -> ImportDropzone displays toast via app/components/Toasts indicating parse failure and suggests re-exporting the chat with media included",
        "zip.readZip succeeds but workers/parseWorker.parse returns parse warnings (unrecognized timestamp formats) -> app shows parsing progress then shows a summary toast with warnings and stores best-effort parsed JSON in IndexedDB"
      ]
    },
    {
      "name": "WhatsApp Chat Viewer",
      "description": "Render a WhatsApp-like conversation UI for a selected chatId, including message bubbles, date separators, sender coloring and read-receipt indicators; supports opening viewer from landing page or direct link.",
      "user_flows": [
        "Navigate to /?chatId={chatId} -> call app/lib/idb.getChat(chatId) -> idb returns parsed messages and metadata -> useChatStore.setChat(parsedMessages, metadata) -> render app/components/ChatLayout with MessageList (virtualized) -> user sees messages with correct alignment and timestamps",
        "Open app root without chatId -> call app/lib/idb.getRecentChats() -> idb returns recent chats list -> landing page renders Recent Chats list -> user clicks Open -> navigate to /?chatId={chatId} and follow happy-path load",
        "Navigate to /?chatId={chatId} -> call app/lib/idb.getChat(chatId) -> idb.getChat returns null (deleted or corrupted) -> viewer displays 'Chat not found' toast and falls back to landing page Recent Chats",
        "Navigate to /?chatId={chatId} for very large chat -> call idb.getChat(chatId) -> idb streams/returns metadata and minimal index -> useChatStore loads minimal state -> MessageList virtualized rendering requests message windows -> MessageList requests messages on-demand from useChatStore -> UI shows progressive rendering without blocking main thread"
      ]
    },
    {
      "name": "Media Handling",
      "description": "Detect and render inline images, videos, audio, PDFs and generic files. Provide lightbox viewer for images, HTML5 playback for video/audio, PDF viewer modal, and file download cards. Show 'Missing file' when media isn't present in the imported archive.",
      "user_flows": [
        "In viewer with chat loaded, click image thumbnail -> call app/lib/mediaIndex.getBlobUrl(chatId, filename) -> mediaIndex returns object URL for blob from current import session -> open app/components/LightboxModal with object URL -> user views full-screen image",
        "In viewer, click PDF attachment card -> call app/lib/mediaIndex.getBlobUrl(chatId, filename) -> mediaIndex returns object URL -> open app/components/PdfViewerModal with object URL -> PDF renders via pdfjs-dist iframe or canvas",
        "User opens a chat loaded from IndexedDB after page reload without re-importing media -> click image thumbnail -> call app/lib/mediaIndex.getBlobUrl(chatId, filename) -> mediaIndex returns null because raw media blobs are not persisted -> viewer displays 'Re-import media for full preview' toast and shows 'Missing file' indicator on attachment card",
        "During import, attachment filename referenced in parsed messages does not match any zip/folder entries -> mediaIndex.build returns missing entry flag -> MessageBubble renders attachment card with 'Missing file' state -> user clicks download on missing file card -> application displays a toast explaining media is missing and suggests re-importing the original export with media included"
      ]
    },
    {
      "name": "Search Functionality",
      "description": "Case-insensitive substring search across message text with match highlighting, match count, and next/previous navigation that jumps the virtualized list to the selected match.",
      "user_flows": [
        "User clicks search icon -> type 'hello' in app/components/SearchBar -> SearchBar calls useChatStore.search('hello') which scans parsed messages -> useChatStore returns match count and indices -> MessageList highlights matches and scrolls to first match via virtualized scroll API",
        "With matches present, user clicks 'next' -> SearchBar calls useChatStore.nextMatch() -> useChatStore returns next match index -> MessageList scrolls to that message and highlights the active match",
        "User types a query with no matches -> SearchBar calls useChatStore.search('nope') -> search returns 0 matches -> UI displays '0 matches' and disables next/prev navigation",
        "User enters a very broad query causing high CPU work -> SearchBar calls useChatStore.search('a') -> search throttles or debounces input and runs in a background iteration (or chunked scan) -> UI shows a spinner/progress and then displays results without freezing the UI"
      ]
    },
    {
      "name": "State Management & Persistence",
      "description": "Global state managed via Zustand with IndexedDB persistence for parsed JSON and metadata. Provide Recent Chats management, delete chat, and re-import workflows for media.",
      "user_flows": [
        "On app load, root layout calls app/lib/idb.getRecentChats() -> idb returns recent chats array -> useChatStore.initialize(recentChats) -> landing page lists recent chats",
        "User deletes a recent chat from landing page -> UI calls app/lib/idb.deleteChat(chatId) -> idb removes chat metadata -> useChatStore removes chat from state -> landing page updates and shows a toast 'Chat deleted'",
        "After importing a chat, save completes -> call app/lib/idb.saveChat(parsedChat, metadata) -> idb persists parsed JSON and metadata -> useChatStore.addRecent(chatId, metadata) -> landing page Recent Chats shows the new entry",
        "idb.getRecentChats returns corrupted or malformed entry -> idb.getRecentChats throws or returns invalid data -> app catches error and shows a recovery toast 'Failed to load recent chats, some entries skipped' and filters out invalid entries from useChatStore"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      {
        "language": "TypeScript"
      },
      {
        "framework": "Next.js 16"
      },
      {
        "library": "React 19"
      },
      {
        "state_management": "Zustand"
      },
      {
        "styling": "TailwindCSS"
      },
      {
        "storage": "IndexedDB (idb)"
      },
      {
        "utilities": "jszip, pdfjs-dist, date-fns, @tanstack/react-virtual"
      }
    ],
    "features": [
      {
        "name": "WhatsApp Chat Viewer",
        "description": "View imported WhatsApp chat exports with message history, media attachments, and search functionality",
        "files": [
          "app/page.tsx",
          "app/components/ChatLayout.tsx",
          "app/components/MessageList.tsx",
          "app/components/MessageBubble.tsx"
        ],
        "routes": [
          {
            "path": "/",
            "description": "Main chat viewer page with optional chatId query parameter"
          }
        ]
      },
      {
        "name": "Chat Import System",
        "description": "Import WhatsApp chat exports from ZIP files or folders, parse messages, and store in IndexedDB",
        "files": [
          "app/components/ImportDropzone.tsx",
          "app/lib/zip.ts",
          "app/lib/chatParser.ts",
          "app/lib/chatDetect.ts",
          "app/workers/parseWorker.ts"
        ]
      },
      {
        "name": "Media Handling",
        "description": "Display and preview images, videos, PDFs and other attachments from chat exports",
        "files": [
          "app/components/AttachmentCard.tsx",
          "app/components/LightboxModal.tsx",
          "app/components/PdfViewerModal.tsx",
          "app/lib/mediaIndex.ts"
        ]
      },
      {
        "name": "State Management",
        "description": "Global state management with Zustand and persistent storage with IndexedDB",
        "files": [
          "app/state/useChatStore.ts",
          "app/lib/idb.ts",
          "app/lib/types.ts"
        ]
      },
      {
        "name": "Search Functionality",
        "description": "Search through chat messages",
        "files": [
          "app/components/SearchBar.tsx"
        ]
      }
    ],
    "known_limitations": []
  }
}
